<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Coagulation Cascade Flowchart</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --ink: #101418;
        --muted: #4c5b6b;
        --panel: #f6f2ec;
        --base: #f0f5f7;
        --accent: #2563eb;
        --intrinsic: #cfe8f8;
        --extrinsic: #d7f2df;
        --common: #fbe3c3;
        --active: #111827;
        --shadow: 0 18px 40px rgba(16, 24, 40, 0.18);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Space Grotesk", "Segoe UI", Arial, sans-serif;
        color: var(--ink);
        background: radial-gradient(circle at 15% 15%, #ffffff, #e9f1f5 55%, #dde7ee 100%);
        min-height: 100vh;
      }

      .page {
        padding: 32px clamp(16px, 4vw, 48px) 48px;
        display: grid;
        gap: 24px;
      }

      header {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      header h1 {
        font-family: "Fraunces", "Times New Roman", serif;
        font-size: clamp(28px, 3.6vw, 46px);
        margin: 0;
        letter-spacing: 0.4px;
      }

      header p {
        margin: 0;
        color: var(--muted);
        max-width: 780px;
      }

      .layout {
        display: grid;
        grid-template-columns: minmax(0, 2.2fr) minmax(0, 1fr);
        gap: 24px;
        align-items: start;
      }

      .chart-shell {
        background: rgba(255, 255, 255, 0.8);
        border-radius: 24px;
        padding: 20px;
        box-shadow: var(--shadow);
      }

      .chart {
        position: relative;
        width: 100%;
        aspect-ratio: 16 / 10;
        border-radius: 20px;
        background: linear-gradient(145deg, #fdfcf9 0%, #eef6fb 70%, #eef8f1 100%);
        overflow: hidden;
      }

      .chart::before {
        content: "";
        position: absolute;
        inset: -20%;
        background: radial-gradient(circle at 70% 10%, rgba(37, 99, 235, 0.12), transparent 55%),
          radial-gradient(circle at 15% 70%, rgba(16, 185, 129, 0.18), transparent 55%);
        opacity: 0.6;
      }

      .chart svg {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
      }

      .path-label {
        position: absolute;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 1.3px;
        color: var(--muted);
        font-weight: 600;
        background: rgba(255, 255, 255, 0.7);
        padding: 6px 10px;
        border-radius: 999px;
        z-index: 2;
      }

      .path-label.intrinsic {
        top: 0%;
        left: 3%;
      }

      .path-label.extrinsic {
        top: 0%;
        right: 2%;
      }

      .path-label.common {
        bottom: 10%;
        left: 5%;
      }

      .node {
        position: absolute;
        left: calc(var(--x) * 1%);
        top: calc(var(--y) * 1%);
        transform: translate(-50%, -50%);
        border: none;
        border-radius: 7px;
        padding: 5px 7px;
        font-size: 6.5px;
        font-weight: 600;
        cursor: pointer;
        background: white;
        color: var(--ink);
        box-shadow: 0 12px 22px rgba(15, 23, 42, 0.15);
        transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        z-index: 3;
        animation: float-in 0.6s ease both;
        animation-delay: calc(var(--d) * 70ms);
      }

      .node:hover,
      .node:focus-visible {
        transform: translate(-50%, -52%) scale(1.02);
        box-shadow: 0 16px 26px rgba(15, 23, 42, 0.2);
        outline: none;
      }

      .node.active {
        background: var(--active);
        color: white;
      }

      .node.intrinsic {
        background: var(--intrinsic);
      }

      .node.extrinsic {
        background: var(--extrinsic);
      }

      .node.common {
        background: var(--common);
      }

      .node.small {
        font-size: 6px;
        padding: 4px 5px;
        border-radius: 6px;
      }

      .panel {
        background: var(--panel);
        border-radius: 24px;
        padding: 22px 22px 24px;
        box-shadow: var(--shadow);
        position: sticky;
        top: 20px;
      }

      .panel h2 {
        font-family: "Fraunces", "Times New Roman", serif;
        margin: 0 0 12px 0;
        font-size: 24px;
      }

      .panel .field {
        margin-bottom: 14px;
      }

      .panel .field h3 {
        margin: 0 0 6px 0;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--muted);
      }

      .panel .field p {
        margin: 0;
        line-height: 1.5;
        font-size: 14px;
      }

      .legend {
        margin-top: 16px;
        display: grid;
        gap: 8px;
        font-size: 13px;
        color: var(--muted);
      }

      .legend span {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .legend i {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
      }

      .legend .i-intrinsic {
        background: var(--intrinsic);
      }

      .legend .i-extrinsic {
        background: var(--extrinsic);
      }

      .legend .i-common {
        background: var(--common);
      }

      @keyframes float-in {
        from {
          opacity: 0;
          transform: translate(-50%, -45%) scale(0.98);
        }
        to {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
        }
      }

      @media (max-width: 980px) {
        .layout {
          grid-template-columns: 1fr;
        }

        .panel {
          position: static;
        }

        .chart {
          aspect-ratio: 4 / 3;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header>
        <h1>Secondary Hemostasis: Coagulation Cascade</h1>
        <p>
          Select any node to learn what it is, how it functions in the cascade, and how a deficiency
          can change clot formation. Use the pathways as a visual map of intrinsic, extrinsic, and
          common activation.
        </p>
      </header>

      <section class="layout">
        <div class="chart-shell">
          <div class="chart" aria-label="Coagulation cascade flowchart">
            <span class="path-label intrinsic">Intrinsic pathway</span>
            <span class="path-label extrinsic">Extrinsic pathway</span>
            <span class="path-label common">Common pathway</span>

            <svg viewBox="0 0 100 100" aria-hidden="true">
              <defs>
                                <marker id="arrow" viewBox="0 0 12 12" refX="10" refY="6" markerWidth="4" markerHeight="4" orient="auto-start-reverse">
                  <path d="M 0 0 L 12 6 L 0 12 z" fill="#1f2937"></path>
                </marker>
              </defs>

                            <g id="connections" stroke="#1f2937" stroke-width="0.55" stroke-linecap="round" fill="none" marker-end="url(#arrow)"></g>
            </svg>

            <div id="nodes"></div>
          </div>
        </div>

        <aside class="panel" aria-live="polite">
          <h2 id="node-title">Select a node</h2>
          <div class="field">
            <h3>Definition</h3>
            <p id="node-definition">Choose a factor to see a concise definition.</p>
          </div>
          <div class="field">
            <h3>Role</h3>
            <p id="node-role">The node role will appear here after selection.</p>
          </div>
          <div class="field">
            <h3>Deficiency impact</h3>
            <p id="node-deficiency">Click a node to view how deficiency affects clotting.</p>
          </div>
          <div class="legend">
            <span><i class="i-intrinsic"></i>Intrinsic pathway</span>
            <span><i class="i-extrinsic"></i>Extrinsic pathway</span>
            <span><i class="i-common"></i>Common pathway</span>
          </div>
        </aside>
      </section>
    </div>

    <script>
      const nodeInfo = {
        f12: {
          name: "Factor XII (Hageman factor)",
          definition: "Contact-activated clotting factor that initiates the intrinsic pathway.",
          role: "Triggers the cascade by activating Factor XI after exposure to negatively charged surfaces.",
          deficiency: "Prolongs aPTT but usually does not cause bleeding; may alter thrombosis risk.",
        },
        f12a: {
          name: "Factor XIIa",
          definition: "Activated form of Factor XII.",
          role: "Amplifies contact activation and converts Factor XI to XIa.",
          deficiency: "Functional deficit mirrors Factor XII deficiency in lab testing.",
        },
        f11: {
          name: "Factor XI",
          definition: "Intrinsic pathway protease zymogen.",
          role: "Activated by XIIa, then helps activate Factor IX.",
          deficiency: "Hemophilia C with variable bleeding and prolonged aPTT.",
        },
        f11a: {
          name: "Factor XIa",
          definition: "Activated form of Factor XI.",
          role: "Activates Factor IX to IXa in the intrinsic arm.",
          deficiency: "Results in reduced IX activation and intrinsic pathway weakness.",
        },
        f9: {
          name: "Factor IX (Christmas factor)",
          definition: "Vitamin K dependent protease in intrinsic pathway.",
          role: "Activated by XIa to form the intrinsic tenase complex.",
          deficiency: "Hemophilia B with deep tissue bleeding and prolonged aPTT.",
        },
        f9a: {
          name: "Factor IXa",
          definition: "Activated Factor IX.",
          role: "Combines with Factor VIIIa to activate Factor X.",
          deficiency: "Functional loss reduces common pathway activation.",
        },
        f8a: {
          name: "Factor VIIIa",
          definition: "Activated cofactor for Factor IXa.",
          role: "Forms the intrinsic tenase complex to accelerate Factor X activation.",
          deficiency: "Hemophilia A with prolonged aPTT and impaired clot formation.",
        },
        injury: {
          name: "Tissue injury",
          definition: "Endothelial disruption that exposes subendothelial tissue factor.",
          role: "Starts the extrinsic pathway by releasing tissue factor.",
          deficiency: "Insufficient exposure slows initial clot formation.",
        },
        tf: {
          name: "Tissue factor (Factor III)",
          definition: "Membrane-bound cofactor expressed by damaged endothelium.",
          role: "Binds Factor VIIa to drive rapid activation of Factor X.",
          deficiency: "Severe deficiency is rare but can cause bleeding with prolonged PT.",
        },
        f7a: {
          name: "Factor VIIa",
          definition: "Activated extrinsic pathway protease.",
          role: "Pairs with tissue factor to activate Factor X.",
          deficiency: "Isolated prolonged PT with mucocutaneous bleeding.",
        },
        tf7a: {
          name: "TF-F7a complex",
          definition: "Active complex of tissue factor and Factor VIIa.",
          role: "Potent activator of Factor X in the extrinsic pathway.",
          deficiency: "Disrupts rapid initiation of coagulation and prolongs PT.",
        },
        f10: {
          name: "Factor X",
          definition: "Common pathway protease zymogen.",
          role: "Activated by intrinsic or extrinsic complexes to Xa.",
          deficiency: "Prolongs PT and aPTT with variable bleeding severity.",
        },
        f10a: {
          name: "Factor Xa",
          definition: "Activated Factor X and key common pathway enzyme.",
          role: "With Factor Va converts prothrombin to thrombin.",
          deficiency: "Markedly reduces thrombin generation and clot stability.",
        },
        f5a: {
          name: "Factor Va",
          definition: "Activated cofactor for the prothrombinase complex.",
          role: "Accelerates conversion of prothrombin to thrombin.",
          deficiency: "Prolongs PT and aPTT with mucosal and soft tissue bleeding.",
        },
        f2: {
          name: "Prothrombin (Factor II)",
          definition: "Vitamin K dependent precursor of thrombin.",
          role: "Converted to thrombin by the prothrombinase complex.",
          deficiency: "Prolonged PT and aPTT with impaired clot formation.",
        },
        f2a: {
          name: "Thrombin (Factor IIa)",
          definition: "Activated serine protease central to coagulation.",
          role: "Converts fibrinogen to fibrin and activates cofactors V and VIII.",
          deficiency: "Low thrombin yields weak or absent fibrin clot.",
        },
        f1: {
          name: "Fibrinogen (Factor I)",
          definition: "Soluble plasma protein and clot precursor.",
          role: "Cleaved by thrombin to form fibrin monomers.",
          deficiency: "Afibrinogenemia causes severe bleeding and poor clot formation.",
        },
        f1a: {
          name: "Fibrin (Factor Ia)",
          definition: "Insoluble polymer formed from fibrinogen.",
          role: "Creates the stable clot scaffold in secondary hemostasis.",
          deficiency: "Weak clot strength and increased bleeding risk.",
        },
        clot: {
          name: "Fibrin clot",
          definition: "Stabilized mesh of fibrin strands with platelets.",
          role: "Seals vascular injury to stop bleeding.",
          deficiency: "Failure to form a stable clot leads to ongoing bleeding.",
        },
      };

      const FLOWCHART_NODES = [
        { id: "f12", text: "F12", x: 12, y: 14, d: 1, kind: "intrinsic" },
        { id: "f12a", text: "F12a", x: 12, y: 22, d: 2, kind: "intrinsic" },
        { id: "f11", text: "F11", x: 12, y: 30, d: 3, kind: "intrinsic" },
        { id: "f11a", text: "F11a", x: 12, y: 38, d: 4, kind: "intrinsic" },
        { id: "f9", text: "F9", x: 12, y: 46, d: 5, kind: "intrinsic" },
        { id: "f9a", text: "F9a", x: 12, y: 54, d: 6, kind: "intrinsic" },
        { id: "f8a", text: "F8a", x: 28, y: 62, d: 7, kind: "intrinsic" },

        { id: "injury", text: "Tissue injury", x: 76, y: 14, d: 3, kind: "extrinsic" },
        { id: "tf", text: "Tissue factor", x: 76, y: 24, d: 4, kind: "extrinsic" },
        { id: "f7a", text: "F7a", x: 90, y: 24, d: 5, kind: "extrinsic", size: "small" },
        { id: "tf7a", text: "TF-F7a complex", x: 74, y: 36, d: 6, kind: "extrinsic" },

        { id: "f10", text: "F10", x: 48, y: 48, d: 8, kind: "common" },
        { id: "f10a", text: "F10a", x: 50, y: 58, d: 9, kind: "common" },
        { id: "f5a", text: "F5a", x: 66, y: 58, d: 10, kind: "common", size: "small" },
        { id: "f2", text: "Prothrombin (F2)", x: 50, y: 68, d: 11, kind: "common" },
        { id: "f2a", text: "Thrombin (F2a)", x: 50, y: 78, d: 12, kind: "common" },
        { id: "f1", text: "Fibrinogen (F1)", x: 38, y: 88, d: 13, kind: "common" },
        { id: "f1a", text: "Fibrin (F1a)", x: 62, y: 88, d: 14, kind: "common" },
        { id: "clot", text: "Clot formation", x: 50, y: 94, d: 15, kind: "common" },
      ];

      const FLOWCHART_CONNECTIONS = [
        { from: "f12", to: "f12a" },
        { from: "f12a", to: "f11" },
        { from: "f11", to: "f11a" },
        { from: "f11a", to: "f9" },
        { from: "f9", to: "f9a" },
        { from: "f9a", to: "f8a" },
        { from: "f8a", to: "f10" },
        { from: "injury", to: "tf" },
        { from: "tf", to: "tf7a" },
        { from: "f7a", to: "tf7a" },
        { from: "tf7a", to: "f10" },
        { from: "f10", to: "f10a" },
        { from: "f5a", to: "f10a" },
        { from: "f10a", to: "f2" },
        { from: "f2", to: "f2a" },
        { from: "f2a", to: "f1" },
        { from: "f1", to: "f1a" },
        { from: "f1a", to: "clot" },
      ];

      const nodesRoot = document.getElementById("nodes");
      const chartEl = document.querySelector(".chart");
      const connectionsEl = document.getElementById("connections");
      const nodeMap = new Map();

      const renderNodes = () => {
        nodesRoot.innerHTML = "";
        FLOWCHART_NODES.forEach((node) => {
          const button = document.createElement("button");
          button.className = ["node", node.kind, node.size].filter(Boolean).join(" ");
          button.dataset.id = node.id;
          button.style.setProperty("--x", node.x);
          button.style.setProperty("--y", node.y);
          button.style.setProperty("--d", node.d);
          button.textContent = node.text;
          nodesRoot.appendChild(button);
          nodeMap.set(node.id, button);
        });
      };

      renderNodes();
      const nodes = Array.from(nodesRoot.querySelectorAll(".node"));
      const titleEl = document.getElementById("node-title");
      const defEl = document.getElementById("node-definition");
      const roleEl = document.getElementById("node-role");
      const defyEl = document.getElementById("node-deficiency");

      const setActive = (id) => {
        nodes.forEach((node) => {
          const active = node.dataset.id === id;
          node.classList.toggle("active", active);
        });
        const info = nodeInfo[id];
        if (!info) return;
        titleEl.textContent = info.name;
        defEl.textContent = info.definition;
        roleEl.textContent = info.role;
        defyEl.textContent = info.deficiency;
      };

      nodes.forEach((node) => {
        node.addEventListener("click", () => setActive(node.dataset.id));
      });

      const getCenter = (rect) => ({
        x: rect.left + rect.width / 2,
        y: rect.top + rect.height / 2,
      });

      const getEdgePoint = (fromRect, toRect) => {
        const fromCenter = getCenter(fromRect);
        const toCenter = getCenter(toRect);
        const dx = toCenter.x - fromCenter.x;
        const dy = toCenter.y - fromCenter.y;
        if (dx === 0 && dy === 0) {
          return { x: fromCenter.x, y: fromCenter.y };
        }
        const hw = fromRect.width / 2;
        const hh = fromRect.height / 2;
        const tx = dx === 0 ? Infinity : hw / Math.abs(dx);
        const ty = dy === 0 ? Infinity : hh / Math.abs(dy);
        const t = Math.min(tx, ty);
        return {
          x: fromCenter.x + dx * t,
          y: fromCenter.y + dy * t,
        };
      };

      const toSvgPoint = (chartRect, point) => ({
        x: ((point.x - chartRect.left) / chartRect.width) * 100,
        y: ((point.y - chartRect.top) / chartRect.height) * 100,
      });

      const drawConnections = () => {
        const chartRect = chartEl.getBoundingClientRect();
        connectionsEl.innerHTML = "";

        FLOWCHART_CONNECTIONS.forEach(({ from, to }) => {
          const source = nodeMap.get(from);
          const target = nodeMap.get(to);
          if (!source || !target) return;
          const fromRect = source.getBoundingClientRect();
          const toRect = target.getBoundingClientRect();
          const start = getEdgePoint(fromRect, toRect);
          const end = getEdgePoint(toRect, fromRect);
          const svgStart = toSvgPoint(chartRect, start);
          const svgEnd = toSvgPoint(chartRect, end);
          const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
          line.setAttribute("x1", svgStart.x.toFixed(2));
          line.setAttribute("y1", svgStart.y.toFixed(2));
          line.setAttribute("x2", svgEnd.x.toFixed(2));
          line.setAttribute("y2", svgEnd.y.toFixed(2));
          connectionsEl.appendChild(line);
        });
      };

      const refreshConnections = () => {
        requestAnimationFrame(drawConnections);
      };

      const resizeObserver = new ResizeObserver(refreshConnections);
      resizeObserver.observe(chartEl);
      window.addEventListener("resize", refreshConnections);

      setActive("f10a");
      refreshConnections();
    </script>
  </body>
</html>
